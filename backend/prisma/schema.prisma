generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id       Int       @id @default(autoincrement())
  email         String    @unique @db.VarChar(255)
  password_hash String    @db.VarChar(255)
  user_type     String    @db.VarChar(20)
  is_active     Boolean?  @default(true)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  faculty       Faculty[]
  students      Student[]

  @@map("users")
}

model Faculty {
  faculty_id   Int          @id @default(autoincrement())
  user_id      Int?
  faculty_name String       @db.VarChar(255)
  email        String?      @db.VarChar(255)
  attendance   Attendance[]
  User         User?        @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  subjects     Subject[]

  @@map("faculty")
}

model Student {
  stud_id     Int          @id @default(autoincrement())
  user_id     Int?
  roll_no     String       @unique @db.VarChar(50)
  stud_name   String       @db.VarChar(255)
  email       String?      @db.VarChar(255)
  semester    String?      @db.VarChar(10)
  attendance  Attendance[]
  enrollments Enrollment[]
  User        User?        @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@map("students")
}

model Subject {
  subject_id   Int          @id @default(autoincrement())
  subject_code String       @unique @db.VarChar(50)
  subject_name String       @db.VarChar(255)
  faculty_id   Int?
  semester     String?      @db.VarChar(10)
  credits      Int?
  attendance   Attendance[]
  enrollments  Enrollment[]
  Faculty      Faculty?     @relation(fields: [faculty_id], references: [faculty_id], onUpdate: NoAction)
  timetable    Timetable[]

  @@map("subjects")
}

model Enrollment {
  stud_id    Int
  subject_id Int
  Student    Student @relation(fields: [stud_id], references: [stud_id], onDelete: Cascade, onUpdate: NoAction)
  Subject    Subject @relation(fields: [subject_id], references: [subject_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([stud_id, subject_id])
  @@map("enrollments")
}

model Timetable {
  timetable_id Int       @id @default(autoincrement())
  subject_id   Int?
  day_of_week  Int?
  start_time   DateTime? @db.Time(6)
  end_time     DateTime? @db.Time(6)
  room_no      String?   @db.VarChar(50)
  Subject      Subject?  @relation(fields: [subject_id], references: [subject_id], onDelete: Cascade, onUpdate: NoAction)

  @@map("timetable")
}

model Attendance {
  attendance_id   Int       @id @default(autoincrement())
  stud_id         Int
  subject_id      Int
  faculty_id      Int
  attendance_date DateTime  @db.Date
  status          String    @db.VarChar(20)
  Faculty         Faculty   @relation(fields: [faculty_id], references: [faculty_id], onDelete: Cascade, onUpdate: NoAction)
  Student         Student   @relation(fields: [stud_id], references: [stud_id], onDelete: Cascade, onUpdate: NoAction)
  Subject         Subject   @relation(fields: [subject_id], references: [subject_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([stud_id, subject_id, attendance_date])
  @@map("attendance")
}
